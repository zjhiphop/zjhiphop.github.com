
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How to build a framework - Jade's fantastic Blog</title>
  <meta name="author" content="zjhiphop">

  
  <meta name="description" content="If let u to build a javascript framework,how will you do?
å¯¹æ¯”å‡ ä¸ªæ¯”è¾ƒæµè¡Œçš„jQueryç­‰æ¡†æ¶ï¼Œä¸éš¾å‘ç°ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŸºç¡€éƒ¨åˆ†ï¼* æµè§ˆå™¨çš„å…¼å®¹æ€§æ£€æµ* å¹²å‡€ï¼Œå¯é‡ç”¨çš„APIè®¾è®¡
* æœ‰ç»Ÿä¸€çš„åŸºå‡†å’Œæ€§èƒ½
* &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zjhiphop.github.com/blog/2012/06/03/how-to-build-a-framework">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jade's fantastic Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Jade's fantastic Blog</a></h1>
  
    <h2>Make a difference.Where amazing happens!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:zjhiphop.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About </a></li> 
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">How to Build a Framework</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-06-03T15:40:00+08:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>If let u to build a javascript framework,how will you do?<br/>
å¯¹æ¯”å‡ ä¸ªæ¯”è¾ƒæµè¡Œçš„jQueryç­‰æ¡†æ¶ï¼Œä¸éš¾å‘ç°ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŸºç¡€éƒ¨åˆ†ï¼br/>
* æµè§ˆå™¨çš„å…¼å®¹æ€§æ£€æµbr/>
* å¹²å‡€ï¼Œå¯é‡ç”¨çš„APIè®¾è®¡<br/>
* æœ‰ç»Ÿä¸€çš„åŸºå‡†å’Œæ€§èƒ½<br/>
* ç¼–å†™æœ‰å¥½çš„è½»é‡çš„javascript<br/>
* ä½¿ç”¨Github</p>

<h2>ä¸ºäº†ä¾¿äºåˆä½œï¼Œæˆ‘ä»¬å¿…é¡»è®¢ç«‹å¥½é¡¹ç›®çš„ç›®æ ‡å’Œå¼€å‘çš„é£æ ¼,ä»¥ä¸‹æ˜¯ä¸€ç§å°è¯•ï¼š</h2>

<blockquote><p>å¤æ‚æ€§Verbose: å˜é‡å’Œæ–¹æ³•åå¿…é¡»æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ˜“æ‡‚å’Œæ˜“ç†è§£<br/>
ç§»æ¤æ€§Portable: æµè§ˆå™¨å’Œæ§åˆ¶åbr/>
æ˜¾å¼çš„Explicit: ä»£ç åº”è¯¥æ˜¯å¯ä»¥å¿«é€Ÿç†è§£çš„<br/>
æ³¨é‡ŠComments: æ³¨é‡Šéœ€è¦ç®€æ´æ˜äº†çš„ã€‚TODO å’FIXME å¯ä»¥è¯¦ç»†ä¸€ç‚<br/>
ç®€å•Simple:   ä¿æŒä»£ç ç®€åbr/>
ç¼©è¿›Indentation: ä¸¤ä¸ªç©ºæ ¼<br/>
åˆ†å·Semicolons:  æ·»åŠ åˆ†å·ä»¥ä¾¿äººä»¬å¯ä»¥æ–¹ä¾¿å‹ç¼©<br/>
è´¨é‡Quality: JsLintå’Œè¯»è€…ç•™è¨€!<br/>
æµ‹è¯•Testing: åœ¨æµè§ˆå™¨å’Œæ§åˆ¶å°ä¸­éƒ½è¦æµ‹è¯br/>
ç‰ˆæœ¬æ§åˆ¶Versioning: ä½¿ç”¨GitHub</p></blockquote>

<h2>é«˜çº§æ¡†æ¶ç»“æ„</h2>

<ul>
<li>prototype</li>
<li>namespace</li>
<li>traits</li>
<li>CommonJS</li>
</ul>


<h3>Helper Methods</h3>

<p>ä¸ºä»€ä¹</p>

<blockquote><p>reduce the effort required to call commonly used functions<br/>
how?<br/>
should be succinct but clear</p></blockquote>

<h3>åˆå§‹åŒ/h3>

<ul>
<li>version</li>
<li>metadata</li>
</ul>


<h3>æ¨¡å—å’Œæ’ä»/h3>

<ul>
<li>define your own global namespace,like jQuery,Mooltools etc.</li>
</ul>


<h3>é€‰æ‹©æµ‹è¯•æ¡†æ¶</h3>

<ul>
<li>riot.js</li>
<li>jasmine</li>
</ul>


<h2>é¢å‘å¯¹è±¡çš„javascript</h2>

<p>ä¸ºä»€ä¹ˆï¼Ÿ<br/>
1. ä¾¿äºç®¡ç†è‡ªå·±çš„ä»£ç br/>
2. å¯¹äºJavaæˆ–Rubyç¨‹åºå‘˜æ¥è¯´å¾ˆä¹ æƒ¯è¿™ç§æ–¹å¼</p>

<h3>åŸå‹vsç±»ç»§æ‰/h3>

<h4>åŸå‹çš„ä¼˜ç‚¹ï¼š</h4>

<ol>
<li>itâ€™s useful to abstract it</li>
<li>offer extra features beyond what JavaScript has as standard</li>
</ol>


<h4>ç±»ç»§æ‰/h4>

<p>ä¼˜ç‚¹ï¼1. keeps code simpler
2. it easer for people to navigate your code.</p>

<p>ç¼ºç‚¹ï¼br/>
1. åˆ›å»ºå¯¹è±¡éœ€è¦ç”¨ä¸€ä¸ªåŒ…è£…å™¨ï¼Œå¦‚ï¼šClass.create</p>

<h3>åˆ›å»ºè‡ªå·±çš„ç»§æ‰¿æ–¹æ³•ï¼š</h3>

<ol>
<li>The ability to extend classes with new methods by copying them</li>
<li>Class creation: use of apply and prototype.constructor to run the constructors</li>
<li>The ability to determine if a parent class is being passed for inheritance</li>
<li>Mixins</li>
</ol>


<h3>ç»§æ‰¿ï¼/h3>

<pre><code>for (var property in source )
    destination [property ] = source [property ];
</code></pre>

<h3>åˆ›å»ºç±»ï¼š</h3>

<pre><code>// This would be defined in our "oo" namespace
create : function (methods ) {
    var klass = function () { this.initialize .apply (this, arguments ); };
    // Copy the passed in methods
    extend (klass .prototype , methods );
    // Set the constructor
    klass .prototype .constructor = klass ;
    // If there's no initialize method, set an empty one
    if (!klass .prototype .initialize )
    klass .prototype .initialize = function (){};
    return klass ;
}
</code></pre>

<h3>æ›´æ·±å±‚æ¬¡çš„ç±»ï¼/h3>

<p>initialize æ–¹æ³•æ˜¯æˆ‘ä»¬çš„æ„é€ å‡½æ•°ã€‚ä½¿ç”¨Class.createçš„æ–¹æ³•æ¥åˆ›å»ºæ–°ç±»ã€/p>

<h3>è¯­æ³•ç³/h3>

<p>Extend === Mixin ?</p>

<p>Mixinæ˜¯é€šè¿‡ç®€å•çš„è§„åˆ™å°†å¯¹è±¡çš„å±æ€§è¿›è¡Œç»„åˆï¼š    Methods should be included from the specified classes    The initialize method should not be overwritten    Multiple includes should be possible</p>

<pre><code>var MixinUser = Root.Class ({
    include : User,
    initialize : function (log) {
        this.log = log;
    }
});
</code></pre>

<p>Super</p>

<pre><code>var SuperUser = Root.Class(User, {
    initialize : function () {
        this.$super('initialize' , arguments );
    },
    toString : function () {
        return "SuperUser: " + this.$super ('toString' );
    }
});
</code></pre>

<h2>å‡½æ•°å¼ç¼–ç¨‹ï¼š</h2>

<p>why?<br/>
1. use ideas from functional programming to simplify common programming tasks<br/>
2. we need define our own method like iterator to cause the browser support is inconsistent<br/>
what?   Describing problems rather than focusing on the mechanics of their solution    Treating functions as first class citizens, and manipulating them like variables   Avoiding state and mutable data</p>

<h3>è¿­ä»£å™¨Iterators</h3>

<blockquote><p>Enumerable uses each to create lots of other methods that are inspired by functional languages. Any collection-style object can mixin Enumerable to get all those methods for free.</p></blockquote>

<p>Underscore&#8217;s each</p>

<pre><code>// The cornerstone, an each implementation.
// Handles objects implementing forEach, arrays, and raw objects.
// Delegates to JavaScript 1.6's native forEach if available.
var each = _.forEach = function (obj, iterator , context ) {
try {
if (nativeForEach &amp;&amp; obj.forEach === nativeForEach ) {
    obj.forEach (iterator , context );
} else if (_.isNumber (obj.length )) {
    for (var i = 0, l = obj.length ; i &lt; l; i++) iterator .call(context , obj[i], i, obj);
} else {
    for (var key in obj) {
        if (hasOwnProperty .call(obj, key)) iterator .call(context , obj[key], key, obj);
    }
}
} catch (e) {
    if (e != breaker ) throw e;
}
    return obj;
};
</code></pre>

<h3>åŸºå‡†Benchmarks</h3>

<blockquote><p>The native method performs very well than defined by yourself</p></blockquote>

<h3>APIè®¾è®¡</h3>

<p>why?<br/>
* easy to use<br/>
* avoid conflict with third party libs <br/>
* safely namespacing</p>

<h3>ä¸ºeachå®šä¹‰æ›´å¤šå‡½æ•°æ–¹æ³•</h3>

<p>Filter<br/>
1. Check if thereâ€™s a native filter method and use it if possible<br/>
2. Else use Root.enumerable.each<br/>
3. Filter objects into multi-dimensional arrays if required<br/>
Detect</p>

<blockquote><p>Detect simply uses each with the user-supplied callback, until a truthy value is returned. Then it throws a Break.<br/>
Chaining<br/>
Chained functions are possible when each function returns an object that can be used to call the next one.<br/>
1. Store temporary values<br/>
2. Runs appropriate methods from Root.enumerable by mapping the temporary value into the first argument<br/>
3. After running the method, return this so the chain can continue</p></blockquote>

<h3>å®ç°ï¼/h3>

<pre><code>// store temporary values in this.results
Root.enumerable .Chainer = Root.Class ({
    initialize : function (values ) {
    this.results = values ;
    },
    values : function () {
    return this.results ;
    }
});
// Map selected methods by wrapping them in a closure that returns this each time
Root.enumerable .each(['map' , 'detect' , 'filter' ], function (methodName ) {
    var method = Root.enumerable [methodName ];
    Root.enumerable .Chainer .prototype [methodName ] = function () {
        var args = Array .prototype .slice .call(arguments );
        args.unshift (this.results );
        this.results = method .apply (this, args);
        return this;
    }
});
</code></pre>

<h2>é€‰æ‹©å™¨å’Œå¼•æ“(Selector and Selector Engines)</h2>

<ol>
<li>XPath</li>
<li>CSS</li>
</ol>


<h3>æµè§ˆå™¨æ”¯æŒ/h3>

<p>Sizzleçš„åšæ³•ï¼š</p>

<blockquote><p>It creates a fake element to probe browser behaviour. Supporting browsers is a black art beyond the patience of most well-meaning JavaScript hackers.</p>

<pre><code>// Check to see if the browser returns elements by name when
// querying by getElementById (and provide a workaround)
(function (){
    // We're going to inject a fake input element with a specified name
    var form = document .createElement ("div" ),
    id = "script" + (new Date()).getTime ();
    form.innerHTML = "&lt;a name='" + id + "'/&gt;" ;
    // Inject it into the root element, check its status, and remove it quickly
    var root = document .documentElement ;
    root.insertBefore ( form, root.firstChild );
</code></pre></blockquote>

<h3>æ€§èƒ½</h3>

<ol>
<li>ç¼“å­˜
2ï¼Œä½¿ç”¨nativeçš„æ–¹æ³•ï¼Œå¦‚ï¼šquerySelectorAll</li>
</ol>


<h3>tools</h3>

<ol>
<li><a href="http://mootools.net/slickspeed/">slickspeed</a></li>
</ol>


<h3>é€‰æ‹©å™¨å¼•æ“/h3>

<ol>
<li><a href="http://jamesdonaghue.com/static/peppy/docs/">Peppy</a></li>
<li><a href="http://digitarald.de/journal/89737433/rolling-out-sly-the-javascript-selector-engine/">sly</a></li>
<li><a href="http://sizzlejs.com/">Sizzle</a></li>
</ol>


<h3>API è®¾è®¡</h3>

<ol>
<li>ä½¿ç”¨å‡½æ•°åŒ…è£…å™¨ï¼Œé“¾å¼è°ƒç”¨</li>
<li>è¿”å›å¹¶æ‰©å±•é€‰æ‹©çš„å…ƒç´ ï¼Œå¦‚prototypeä½¿ç”¨$()ä½¿ç”¨getElementById.$$()ä½¿ç”¨CSSæˆ–XPath</li>
</ol>


<h3>ç›®æ ‡</h3>

<ol>
<li>CSS selectors only (XPath could be a future upgrade or plugin)</li>
<li>Limited pseudo-selectors. Implementing one or two would be nice just to establish the API for them</li>
<li>Defer to native methods as quickly as possible</li>
<li>Cache for performance</li>
<li>Expose the parsing results like Sly does</li>
<li>Reuse the wisdom of existing selector engines for patching browser nightmares</li>
</ol>


<h3>CSS é€‰æ‹©å™/h3>

<blockquote><p><a href="http://www.w3.org/TR/CSS2/selector.html">CSS2 selectors</a>,<a href="http://www.w3.org/TR/CSS21/grammar.html">CSS2 grammer</a><br/>
1. E â€Matches any element named E<br/>
2. E F â€Matches any element F that descends from E<br/>
3. .class â€Matches any element with the class class<br/>
4. E.class â€Matches any element named E with the class class<br/>
5. #id â€Matches any element with the id id<br/>
6. E#id â€Matches any element named E with the id id</p></blockquote>

<h3>CSSçš„è§£æè§„åˆ/h3>

<ol>
<li>ID Rules</li>
<li>Class Rules</li>
<li>Tag Rules</li>
<li><p>Universal Rules<br/>
<a href="https://developer.mozilla.org/en/Writing_Efficient_CSS">Writing_Efficient_CSS</a></p></li>
<li><p>Avoid universal rules</p></li>
<li>Donâ€™t qualify ID rules with tag names or classes

<blockquote><p>BAD
 button#backButton {â€¦}<br/>
 BAD<br/>
 .menu-left#newMenuIcon {â€¦}<br/>
 GOOD<br/>
 #backButton {â€¦}<br/>
 GOOD<br/>
 #newMenuIcon {â€¦}</p></blockquote></li>
<li>Donâ€™t qualify class rules with tag names

<blockquote><p>BAD<br/>
 treecell.indented {â€¦}<br/>
 GOOD<br/>
 .treecell-indented {â€¦}<br/>
 BEST<br/>
 .hierarchy-deep {â€¦}</p></blockquote></li>
<li>Use the most specific category possible

<blockquote><p>BAD<br/>
 treecell.indented {â€¦}<br/>
 GOOD<br/>
 .treecell-indented {â€¦}<br/>
 BEST<br/>
 .hierarchy-deep {â€¦}</p></blockquote></li>
<li>Avoid the descendant selector

<blockquote><p>BAD<br/>
 treehead treerow treecell {â€¦}<br/>
 BETTER, BUT STILL BAD (see next guideline)  <br/>
 treehead > treerow > treecell {â€¦}</p></blockquote></li>
<li>Tag category rules should never contain a child selector

<blockquote><p>BAD<br/>
 treehead > treerow > treecell {â€¦}<br/>
 GOOD<br/>
 .treecell-header {â€¦}</p></blockquote></li>
<li>Question all usages of the child selector

<blockquote><p>BAD<br/>
 treeitem[IsImapServer=&#8221;true&#8221;] > treerow > .tree-folderpane-icon {â€¦}<br/>
 GOOD<br/>
 .tree-folderpane-icon[IsImapServer=&#8221;true&#8221;] {â€¦}</p></blockquote></li>
<li>Rely on inheritance

<blockquote><p>BAD<br/>
 #bookmarkMenuItem > .menu-left { list-style-image: url(blah) }<br/>
 GOOD<br/>
 #bookmarkMenuItem { list-style-image: url(blah) }</p></blockquote></li>
<li>Use -moz-image-region for ff!</li>
<li>Use <a href="http://updates.html5rocks.com/2012/03/A-New-Experimental-Feature-style-scoped">scoped stylesheets</a> to reduce inefficiency of universal rules and child selectors</li>
</ol>


<h3>åˆ†è¯å™Tokenizer)</h3>

<h3>ç»™ä½ ä¸€ä¸ªselectorï¼Œæˆ‘ä»¬éœ€è¦åšï¼/h3>

<ol>
<li>å»æ‰é¢å¤–çš„ç©ºæ /li>
<li>ç”¨æŸç§æ–¹æ³•å¤„ç†å¹¶è½¬åŒ–ä¸ºä¸€ç³»åˆ—çš„æŒ‡ä»¤è§£æå™¨å¤„ç†</li>
<li><p>Run the tokens through the parser against the DOM</p>

<p> function Token (identity , finder ) {</p>

<pre><code> this.identity = identity ;
 this.finder = finder ;
</code></pre>

 }
 Token .prototype .toString = function () {

<pre><code> return 'identity: ' + this.identity + ', finder: ' + this.finder ;
</code></pre>

 };
 //The finder property is one of those keys in findMap. The identity is the original rule from the selector.

<h3>æ‰«æå™Scanner)</h3>

<blockquote><p>CSS grammer specification
 macros = {</p>

<pre><code> 'nl': '\n|\r\n|\r|\f' ,
 'nonascii' : '[^\0-\177]' ,
 'unicode' : '\\[0-9A-Fa-f]{1,6}(\r\n|[\s\n\r\t\f])?'
 'escape' : '#{unicode}|\\[^\n\r\f0-9A-Fa-f]' ,
 'nmchar' : '[_A-Za-z0-9-]|#{nonascii}|#{escape}'
 'nmstart' : '[_A-Za-z]|#{nonascii}|#{escape}' ,
 'ident' : '[-@]?(#{nmstart})(#{nmchar})*' ,
 'name' : '(#{nmchar})+'
</code></pre>

<p> };
 rules = {</p>

<pre><code> 'id and name' : '(#{ident}##{ident})' ,
 'id': '(##{ident})' ,
 'class' : '(\\.#{ident})' ,
 'name and class' : '(#{ident}\\.#{ident})' ,
 'element' : '(#{ident})' ,
 'pseudo class' : '(:#{ident})'
</code></pre>

<p> };</p></blockquote></li>
</ol>


<h3>æ‰«æå™¨å°†åšä»¥ä¸‹äº‹æƒ…ï¼š</h3>

<ul>
<li>Expanding #{} in the macros</li>
<li>Expanding #{} in the rules based on the expanded macros</li>
<li>Escaping the backslashes</li>
<li>Joining each of the patterns with |</li>
<li>Building a global regular expression with the RegExp class</li>
</ul>


<h3>æœç´¢å™Searcher)</h3>

<p>æœç´¢å™¨ä½¿ç”¨åˆ†è¯å™¨çš„å¤„ç†ç»“æœæ¥æœç´¢domã€‚åˆå§‹åŒ–æ—¶éœ€è¦æŒ‡å®šæœç´¢çš„rootå…ƒç´ å’Œä¸€ä¸ªtokenæ•°ç»„ã€/p>

<pre><code>find = {
byId: function (root, id) {
    return [root.getElementById (id)];
},
byNodeName : function (root, tagName ) {
    var i, results = [], nodes = root.getElementsByTagName (tagName );
    for (i = 0; i &lt; nodes .length ; i++) {
        results .push(nodes [i]);
    }
    return results ;
},
byClassName : function (root, className ) {
    var i, results = [], nodes = root.getElementsByTagName ('*');
    for (i = 0; i &lt; nodes .length ; i++) {
        if (nodes [i].className .match ('\\b' + className + '\\b' )) {
            results .push(nodes [i]);
        }
    }
    return results ;
}
};
findMap = {
'id': function (root, selector ) {
    selector = selector .split ('#')[1];
    return find.byId(root, selector );
},
'name and id' : function (root, selector ) {
    var matches = selector .split ('#'), name, id;
    name = matches [0];
    id = matches [1];
    return filter .byAttr (find.byId(root, id), 'nodeName' , name.toUpperCase ());
}
// ...
};
</code></pre>

<h2>Events</h2>

<h3>åŸºæœ¬çš„äº‹ä»¶ç»‘å®šæ–¹å¼/h3>

<ol>
<li>inline</li>
<li>element.onXXX

<h3>è®¿é—®äº‹ä»¶</h3>

<p>eventæˆ–è€…window.eventï¼Œè™½ç„¶ç›´æ¥è®¿é—®window.eventæœ‰æ½œåœ¨çš„å±é™©ï¼Œå› ä¸ºwindow.eventæ˜¯ä¿å­˜åœ¨ä¸Šä¸€æ¬¡çš„äº‹ä»¶å¯¹è±¡ï¼Œä½†javascriptæ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ä»–æ˜¯å®‰å…¨çš„ã€br/>
ä¸­æ–­äº‹ä»¶(Stopping Events)</p></li>
<li>return false

<h3>äº‹ä»¶æ•è·å’Œå†’æ³/h3>

<p>whyï¼/p></li>
<li>åŒæ—¶ç»‘å®šç»™ä¸¤ä¸ªçˆ¶å­çº§å…ƒç´ ç»‘å®šclickäº‹ä»¶ï¼Œå¾ˆéš¾ç¡®å®šäº‹ä»¶çš„æ‰§è¡Œé¡ºåº</li>
<li>ä¸åŒçš„æµè§ˆå™¨æœ‰ä¸åŒçš„å¤„ç†æ–¹æ³•<br/>
Howï¼br/>
 function handler (event ) {

<pre><code> if (!event ) var event = window .event ;
 event .cancelBubble = true;
 if (event .stopPropagation ) event .stopPropagation ();
</code></pre>

 }

<h3>å¤šä¸ªäº‹ä»¶å¤„ç†å™/h3>

<p>egï¼ element .onclick = function () { alert (&#8216;Hello World!&#8217; ); return false ; };
 element .onclick = function () { alert (&#8216;This was the best example I could think of&#8217;); return false;}
 //è¿™é‡Œç¬¬äºŒä¸ªäº‹ä»¶ä¼šå°†ç¬¬ä¸€ä¸ªäº‹ä»¶è¦†ç›/p></li>
</ol>


<h3>äº‹ä»¶apiçš„å®šä¹/h3>

<ol>
<li>Normalise event names, so onClick becomes click</li>
<li>Easy event registration and removal</li>
<li>Simple cross-browser access to the event object in handlers</li>
<li>Mask the complexities of event bubbling</li>
<li>Provide cross-browser access to keyboard and mouse interaction</li>
<li>Patch browser incompetency like IE memory leaks<br/>
jQueryçš„åšæ³
<blockquote><p>$(&#8216;a&#8217;).click (function (event ) {<br/>
alert (&#8216;A link has been clicked&#8217; );<br/>
});<br/>
The Eventâ€™s element is in event.target<br/>
The current event within the bubbling phase is in event.currentTarget â€also found in the
this object in the function  <br/>
The default action can be prevented with event.preventDefault()<br/>
Bubbling can be stopped with event.stopPropagation();<br/>
Events can be removed with $(&#8216;a&#8217;).unbind(&#8216;click&#8217;);<br/>
Events can be fired with $(&#8216;a&#8217;).trigger(&#8216;click&#8217;);</p></blockquote></li>
</ol>


<p>Prototypeçš„åšæ³/p>

<blockquote><p>$(&#8216;id&#8217;).observe (&#8216;click&#8217; , function (event ) {<br/>
var element = Event .element (event );<br/>
});<br/>
The Eventâ€™s element can be accessed with Event.element(event) or event.element();<br/>
Events are stopped with Event.stop()<br/>
Events can be removed with Event.stopObserving(element, eventName, handler);<br/>
Events can be fired with Event.fire(element)</p></blockquote>

<p>Glowçš„åšæ³/p>

<blockquote><p>glow.events .addListener (&#8216;a&#8217;, &#8216;click&#8217; , function (event ) {  <br/>
alert (&#8216;Hello World!&#8217; );<br/>
});<br/>
The Eventâ€™s element is in event.source<br/>
The default action can be prevented by returning false<br/>
Events can be removed with glow.events.removeListener(handler) where handler is<br/>
the returned value from glow.events.addListener<br/>
Events can be fired with glow.events.fire()</p></blockquote>

<p>Dojoçš„åšæ³/p>

<blockquote><p>dojo.connect (dojo.byId(&#8216;a#hello&#8217; ), &#8216;onclick&#8217; , function (event ) {</p>

<pre><code>alert ('Hello World!' );  
</code></pre>

<p>});<br/>
Notice that the event names arenâ€™t mapped. Like the other frameworks, the event object is normalised.<br/>
The Eventâ€™s element is in event.target<br/>
The current event within the bubbling phase is in event.currentTarget â€this is also this in
the function<br/>
The default action can be prevented with event.preventDefault()<br/>
Bubbling can be stopped with event.stopPropagation();<br/>
Events can be removed with dojo.disconnect()</p></blockquote>

<h3>æ€»ç»“</h3>

<p>åœ¨ä»¥ä¸Šçš„frameworkä¸­ï¼Œjqueryçš„event handleræ˜¯æœ€å…·æœ‰é­…åŠ›çš„ï¼Œé¦–å…ˆï¼Œå®ƒç»Ÿä¸€ä½¿ç”¨W3Cçš„äº‹ä»¶ç³»ç»Ÿåœ¨å„ä¸ªæµè§ˆå™¨ä¸­ï¼Œè¾ƒå¥½çš„åç§°ç©ºé—´ï¼Œå®Œå…¨è§£å†³äº†äº‹ä»¶å†’æ³¡é—®é¢˜ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºMicorosoftçš„APIåœ¨å†’æ³¡æ—¶çš„é—®é¢˜ã€/p>

<h3>å®ç°</h3>

<ol>
<li>event.srcElement , event.target</li>
<li>äº‹ä»¶ç»‘å®š  attachEvent,addEventlistener</li>
<li>éªŒè¯å…ƒç´ æ˜¯å¦æœ‰æ•ˆï¼Œç¡®ä¿å…ƒç´ éæ–‡æœ¬å’Œæ³¨é‡ŠèŠ‚ç‚/li>
<li>é˜»æ­¢é»˜è®¤å’Œå†’æ³¡äº‹ä»/li>
<li>å…¶ä»–çš„æµè§ˆå™¨ä¿®å¤</li>
<li>NodeList</li>
<li>äº‹ä»¶ä»£ç†<br/>
 //Safariâ€™s handling of text nodes<br/>
 //Missing values for event.pageX/Y<br/>
 //Key events get event.which and event.metaKey is corrected<br/>
 //event.which is also added for mouse button index
 function stop(event ) {

<pre><code> event .preventDefault (event );
 event .stopPropagation (event );
</code></pre>

 }
 function fix(event , element ) {

<pre><code> if (!event ) var event = window .event ;
     event .stop = function () { stop(event ); };
 if (typeof event .target === 'undefined' )
     event .target = event .srcElement || element ;
 if (!event .preventDefault )
     event .preventDefault = function () { event .returnValue = false ; };
 if (!event .stopPropagation )
     event .stopPropagation = function () { event .cancelBubble = true; };
 return event ;
</code></pre>

 }
 var _isButton ;
 if (Prototype .Browser .IE) {

<pre><code> // IE doesn't map left/right/middle the same way.
 var buttonMap = { 0: 1, 1: 4, 2: 2 };
 _isButton = function (event , code) {
 return event .button === buttonMap [code];
</code></pre>

 } else if (Prototype .Browser .WebKit ) {

<pre><code> // In Safari we have to account for when the user holds down
 // the "meta" key.
 _isButton = function (event , code) {
 switch (code) {
     case 0: return event .which == 1 &amp;&amp; !event .metaKey ;
     case 1: return event .which == 1 &amp;&amp; event .metaKey ;
     default : return false ;
 }
</code></pre>

 } else {

<pre><code> _isButton = function (event , code) {
 return event .which ? (event .which === code + 1) : (event .button === code);
</code></pre>

<p> }</p></li>
</ol>


<h2>Ajax</h2>

<p><a href="http://www.w3.org/TR/XMLHttpRequest/">XMLHttpRequest</a></p>

<h3>how to cross domain ?</h3>

<ol>
<li>use flash or Silverlight</li>
<li>use XMLHttpRequest Level2 withCredentials attribute</li>
<li>using dynamically inserted script tags, image tags, and iframes.</li>
<li>JSONP</li>
<li>Cross-origin resource sharing ,eg: Access-Control-Allow-Origin: *</li>
<li>use XDomain object for IE</li>
</ol>


<h3>åˆ›å»ºå…¼å®¹çš„XMLHttpRequestå¯¹è±¡</h3>

<ol>
<li>Differences between Microsoftâ€™s implementation and W3C have to be dealt with</li>
<li>Request headers must be set for the type of data and HTTP methpd</li>
<li>State changes must be handled through callbacks</li>
<li><p>Browser bugs must be compensated for</p>

<p> function xhr() {
 if (typeof XMLHttpRequest !== &#8216;undefined&#8217; &amp;&amp; (window .location .protocol !== &#8216;file:&#8217; || !window.ActiveXObject)){
 return new XMLHttpRequest ();
 } else {
 try {
 return new ActiveXObject (&#8216;Msxml2.XMLHTTP.6.0&#8217; );
 } catch (e) { }
 try {
 return new ActiveXObject (&#8216;Msxml2.XMLHTTP.3.0&#8217; );
 } catch (e) { }
 try {
 return new ActiveXObject (&#8216;Msxml2.XMLHTTP&#8217; );
 } catch (e) { }
 }
 return false ;
 }</p></li>
</ol>


<h3>å‘é€è¯·æ±/h3>

<ol>
<li>Set a callback for onreadystatechange</li>
<li>Call open on the request object</li>
<li>Set the request headers</li>
<li>Call send on the object</li>
</ol>


<blockquote><p>readystate
0: Uninitialized: open has not been called
1: Loading: send has not been called
2: Loaded: send has been called, headers and status are available
3: Interactive: Downloading, responseText holds the partial data
4: Completed: Request finishe</p></blockquote>

<h3>ajax APIè®¾è®¡</h3>

<p>jQuery</p>

<pre><code>$.ajax({
url: url,
data: data,
success : success ,
dataType : dataType
});
</code></pre>

<p>Prototype</p>

<pre><code>new Ajax.Request ('/your/url' , {
    onSuccess : function (response ) {
    // Handle the response content...
    }
});
</code></pre>

<p>Glow</p>

<pre><code>if (response .wasSuccessful ) {
    events .fire(request , "load" , response );
} else {
    events .fire(request , "error" , response );
}
</code></pre>

<h2>åŠ¨ç”»(Animations)</h2>

<h3>JavaScriptåŠ¨ç”»</h3>

<p>Methods to work with CSS properties and animate them<br/>
A queuing system, for scheduling animations, and animating each â€œframeâ€CSS colour parsing<br/>
Helpers that make common web effects easy to use alongside events</p>

<h3>åŠ¨ç”»æ¡†æ¶</h3>

<ol>
<li>æœ€æµè¡Œçš„æ¡†æa href="http://madrobby.github.com/scriptaculous/combination-effects-demo/">aculo</a></li>
<li>Mootools <a href="http://mootools.net/docs/core/Fx/Fx">FX</a></li>
<li>jQuery <a href="http://api.jquery.com/animate/">animate</a></li>
<li>Glow <a href="http://www.bbc.co.uk/glow/docs/1.7/api/glow.anim.animation.shtml">animation</a>

<h3>åŠ¨ç”»é˜Ÿåˆ—</h3>

setInterval å’clearInterval æ¥å¤„ç†äº‹ä»¶åºåˆ<br/>
Easing function

<blockquote><p>â€œEase-inâ€and â€œease-outâ€in digital animation typically refer to a mechanism for defining the
â€˜physicsâ€of the transition between two animation states, eg. the linearity of a tween.</p></blockquote></li>
</ol>


<h3>ç¼–å†™ easing å‡½æ•°</h3>

<pre><code>var easing = {};
easing .linear = function (position ) {
    return position ;
};
easing .sine = function (position ) {
    return (-Math.cos(position * Math.PI) / 2) + 0.5;
};
easing .sine = function (position ) {
    return (-Math.cos(position * Math.PI) / 2) + 0.5;
};
</code></pre>

<h3>åŠ¨ç”»helperå‡½æ•° &#8211; ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ç‰¹æ•ˆçš„å°è£/h3>

<ul>
<li>Fade â€fade an element by changing its opacity</li>
<li>Highlight â€rapidly change an elementâ€™s background colour to draw attention to it</li>
<li>Movement â€move an element<br/>
  root.anim.fade(element , duration , { &#8216;from&#8217; : &#8216;8em&#8217; , &#8216;to&#8217;: &#8216;100px&#8217; , &#8216;easing&#8217; : easing });
  anim.fadeIn = function (element , duration , options ) {

<pre><code>                  options = options || {};
                  options .from = options .from || 0.0;
                  options .to = options .to || 1.0;
                  return anim.fade(element , duration , options );
              };
</code></pre>

  anim.fadeOut = function (element , duration , options ) {

<pre><code>                  var from;
                  options = options || {};
                  options .from = options .from || 1.0;
                  options .to = options .to || 0.0;
                  // Swap from and to
                  from = options .from;
                  options .from = options .to;
                  options .to = from;
                  // This easing function reverses the position value and adds from
                  options .easing = function (p) { return (1.0 - p) + options .from; };
                  return anim.fade(element , duration , options , { 'easing' : options .easing });
              };
</code></pre>

<h3>ä½¿ç”¨CSS3</h3>

<blockquote><p>CSS Transitions Module Level 3<br/>
CSS 2D Transforms Module Level 3<br/>
CSS 3D Transforms Module Level 3<br/>
CSS Animations Module Level 3</p></blockquote>

  .example {

<pre><code>  -webkit -transition : all 1s ease-in-out;
  -moz-transition : all 1s ease-in-out;
  -o-transition : all 1s ease-in-out;
  -webkit -transition : all 1s ease-in-out;
  transition : all 1s ease-in-out;
</code></pre>

<p>  }</p></li>
</ul>


<p>CSS3 åŠ¨ç”»<br/>
use keyframe</p>

<pre><code>@keyframes 'wobble' {
0% {
left: 100px;
}
40% {
left: 150px;
}
60% {
left: 75px;
}
100% {
left: 100px;
}
}
</code></pre>

<h3>åŠ¨ç”»æ€§èƒ½</h3>

<ol>
<li>Animating margin, padding, background, outline, and border will all result in relatively
slow animations.</li>
<li>Hardware Acceleration

<h3>ç‰¹æ€§æ£€æµ/h3>

æ˜¯å¦æ”¯æŒç¡¬ä»¶åŠ é€<br/>
 function isHWAcceleratedSafari () {

<pre><code> var ua = navigator .userAgent , av = navigator .appVersion ;
 return (!ua.include ('Chrome' ) &amp;&amp; av.include ('10_6' )) ||
 Prototype .Browser .MobileSafari ;
</code></pre>

<p> }
æ˜¯å¦æ”¯æŒWebKitTransitionEvent æˆMozTransition</p>

<p>  var div = document .createElement (&#8216;div&#8217; );
  try {</p>

<pre><code>  document .createEvent ("WebKitTransitionEvent" );
  supported = true;
  hardwareAccelerationSupported = isHWAcceleratedSafari ();
</code></pre>

  } catch (e) {
  if (typeof div.style .MozTransition !== &#8216;undefined&#8217; ) {

<pre><code>  supported = true;
</code></pre>

  }
  }
  div = null;
æŸ¥è¯¢æµè§ˆå™¨å‚å•†æ”¯æŒ  // CSS3 vendor detection
  vendors = {
  // Opera Presto 2.3
  &#8216;opera&#8217; : {

<pre><code>  'prefix' : '-o-' ,
  'detector' : function () {
      try {
          document .createEvent ('OTransitionEvent' );
          return true;
      } catch (e) {
          return false ;
      }
  }
</code></pre>

  },
  // Chrome 5, Safari 4
  &#8216;webkit&#8217; : {

<pre><code>  'prefix' : '-webkit-' ,
  'detector' : function () {
      try {
          document .createEvent ('WebKitTransitionEvent' );
          return true;
      } catch (e) {
          return false ;
      }
  }
</code></pre>

  },
  // Firefox 4
  &#8216;firefox&#8217; : {

<pre><code>  'prefix' : '-moz-' ,
  'detector' : function () {
      var div = document .createElement ('div' ),
      supported = false ;
      if (typeof div.style .MozTransition !== 'undefined' ) {
          supported = true;
      }
          div = null;
          return supported ;
      }
  }
</code></pre>

  };
  function findCSS3VendorPrefix () {

<pre><code>  for (var detector in vendors ) {
      detector = vendors [detector ];
      if (detector ['detector' ]()) {
          return detector ['prefix' ];
      }
  }
</code></pre>

  }

<h3>ç§»åŠ¨åŠ¨ç”»çš„å®ç/h3>

<p>Detect when a CSS property is being used to move an element<br/>
Get the vendor prefix<br/>
Set up CSS3 style properties instead of using JS animation engine</p></li>
</ol>


<h2>æ”¯æŒTouchScreen</h2>

<h3>ç›®å‰æ”¯æŒçš„frameworkï¼/h3>

<ol>
<li><a href="http://www.jqtouch.com/">jQTouch</a> : iPhone, iPad and Android phones</li>
<li>Sencha Touch</li>
</ol>


<h3>Debugging Touch</h3>

<ol>
<li><a href="http://developer.android.com/guide/developing/tools/adb.html">Android Debug Bridge</a></li>
<li>Iphone debug console</li>
<li><a href="http://people.apache.org/~pmuellr/weinre/docs/latest/">Weinre</a></li>
</ol>


<h3>æ—‹è½¬  Orientation Property</h3>

<pre><code>root.touch.orientation = function () {
    var orientation = window .orientation ,
    orientationString = '';
    switch (orientation ) {
        case 0:
        orientationString += 'portrait' ;
        break ;
        case -90:
        orientationString += 'landscape right' ;
        break ;
        case 90:
        orientationString += 'landscape left' ;
        break ;
        case 180:
        orientationString += 'portrait upside-down'
        break ;
    }
    return [orientation , orientationString ];
};
</code></pre>

<p>Touch Events<br/>
touchstart<br/>
touchmove<br/>
touchend<br/>
touchcancel</p>

<h3>Touch äº‹ä»¶å¯¹è±¡</h3>

<p>event.touches: All touches on the page<br/>
event.targetTouches: Touches for the target element<br/>
event.changedTouches: Changed touches for this event</p>

<h3>Touch state</h3>

<p>If thereâ€™s just one event and the position hasnâ€™t changed, itâ€™s a tap event<br/>
If touchmove fired, work out the distance of the movement and how long it took for a swipe</p>

<h2>é“¾å¼è°ƒç”¨API</h2>

<p><a href="http://code.google.com/p/fakequery/">fakeQuery</a></p>

<h3>æ€»ç»“</h3>

<p>A â€œcontainer functionâ€is used to create new objects without having to type new<br/>
It returns objects based on a CSS selector<br/>
A class is created and copied so usage of methods like find can be called in a chain</p>

<h3>Event Handler Shortcuts and Loop Scoping</h3>

<pre><code>events .addDOMethods = function () {
    if (typeof root .domChain === 'undefined' ) return ;
    root .domChain .bind = function (type, handler ) {
    var element = this.first ();
    if (element ) {
        root .events .add(element , type, handler );
        return this;
    }
};
var chainedAliases = ('click dblclick mouseover mouseout mousemove ' +
'mousedown mouseup blur focus change keydown ' +
'keypress keyup resize scroll' ).split (' ');
    for (var i = 0; i &lt; chainedAliases .length ; i++) {
        (function (name) {
        root .domChain [name] = function (handler ) {
        return this.bind(name, handler );
        };
        })(chainedAliases [i]);
    }
};
</code></pre>

<h2>ç‰¹æ€§æ£€æµ egï¼šquerySelectorAll</h2>

<h3>å®ç°</h3>

<pre><code>var testCache = {},
detectionTests = {};
root.addDetectionTest = function (name, fn) {
    if (!detectionTests [name])
    detectionTests [name] = fn;
    };
    root.detect = function (testName ) {
    if (typeof testCache [testCache ] === 'undefined' ) {
    testCache [testName ] = detectionTests [testName ]();
    }
    return testCache [testName ];
};
//æ£€æµ‹querySelectorAll
turing .addDetectionTest ('querySelectorAll' , function () {
    var div = document .createElement ('div' );
    div.innerHTML = '&lt;p class="TEST"&gt;&lt;/p&gt;' ;
    // Some versions of Safari can't handle uppercase in quirks mode
    if (div.querySelectorAll ) {
        if (div.querySelectorAll ('.TEST' ).length === 0) return false ;
        return true;
    }
    // Helps IE release memory associated with the div
    div = null;
    return false ;
});
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">zjhiphop</span></span>

      








  


<time datetime="2012-06-03T15:40:00+08:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/thinking-in-js/'>thinking in JS</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://zjhiphop.github.com/blog/2012/06/03/how-to-build-a-framework/" data-via="" data-counturl="http://zjhiphop.github.com/blog/2012/06/03/how-to-build-a-framework/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/06/03/js-web-applications/" title="Previous Post: JS Web Applications">&laquo; JS Web Applications</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/06/03/beat-win7-64bit-blue-screen/" title="next Post: Beat Win7 64bit Blue Screen">Beat Win7 64bit Blue Screen &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/07/21/some-valueable-links/">Some Valueable Links</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/05/interesting-js-puzzle/">interesting_js_puzzle</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/04/frontend-architecture/">frontend architecture</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/22/async-javascript/">async javascript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/07/10-small-habits-of-less-stressed-people/">è½»æ¾ç”Ÿæ´»çš„åä¸ªå°ä¹ æƒ¯</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - zjhiphop -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
